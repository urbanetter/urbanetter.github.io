<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Frontend performance - wher it matters</title>

		<meta name="description" content="A talk about where frontend performance really matters">
		<meta name="author" content="Urban Etter">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/beige.css" id="theme">
		<link rel="stylesheet" href="css/frontend_performance.css">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Frontend Performance</h1>
					<h3>Where it matters</h3>
					<p>
						<small>Urban Etter</small>
					</p>
				</section>

				<section>
					<section>
						<h1>About me</h1>
					</section>
					<section>
						<h2>Urban Legends</h2>
					</section>
					<section>
						<h2>Urban Myths</h2>
					</section>
					<section>
						<h2>Urban Species</h2>
					</section>
					<section>
						<h2>Urban Etter</h2>
					</section>
					<section>
						<img src="img/srf_logo.png">
					</section>
					<section>
						<h2>Schweizer Radio und Fernsehen</h2>
					</section>
					<section>
						<h2>Web Architect</h2>
					</section>
					<section>
						<h2>Part of the Frontend Team</h2>
					</section>
				</section>

				<section>
					<section>
						<h3>Performance is a</h3>
						<h1>HUGE</h1>
						<h3>topic</h3>
					</section>
					<section>
						<aside class="notes">I could talk about...</aside>
						<h2>Cache invalidation</h2>
					</section>
					<section>
						<h2>Vertical scaling</h2>
					</section>
					<section>
						<h2>Database clusters</h2>
					</section>
					<section>
						<h1>This talk is not about that</h1>
					</section>
					<section>
						<h3>Tricks to make your website faster when you're</h3>
						<h2>yahoo.com</h2>
					</section>
					<section>
						<p><code>['hello', 'world'].join(' ')</code></p>
						<p>instead of</p>
						<p><code>'hello' + ' ' + 'world'</code></p>
					</section>
					<section>
						<h1>This talk is neither about that</h1>
					</section>
					<section>
						<h2>Good practices</h2>
					</section>
					<section>
						<h2>Some traps</h2>
					</section>
					<section>
						<h2>Some code</h2>
					</section>
					<section>
						<h2>Frontend performance for the</h2>
						<h1>craftsmen</h1>
					</section>
				</section>

				<section>
					<section>
						<h1>Performance matters</h1>
					</section>
					<section>
						<blockquote>
							... that slowing down the search results page by 100 to 400 milliseconds has a measurable impact on the number of searches per user of -0.2% to -0.6%
						</blockquote>
						<p>by <a href="http://googleresearch.blogspot.ch/2009/06/speed-matters.html">Google</a></p>
					</section>
					<section>
						<blockquote>
							To get that sensation, your requests need to take less than 100ms.
						</blockquote>
						<p>by <a href="http://37signals.com/svn/posts/3112-how-basecamp-next-got-to-be-so-damn-fast-without-using-much-client-side-ui">37 signals</a>
					</section>
					<section>
						<h2>Performance is a</h2>
						<h1>feature</h1>
					</section>
					<section>
						<h2>It takes effort to get it right</h2>
					</section>
					<section>
						<h2>It often conflicts with other features</h2>
						<h3 class="fragment">Reduced complexity</h3>
						<h3 class="fragment">Maintainability</h3>
						<h3 class="fragment">Security/h3>
					</section>
					<section>
						<h3>Involves almost every discipline in web development</h3>
					</section>
				</section>

				<section>
					<section>
						<h1>Loading process</h1>
					</section>
					<section>
						<h2>Key to frontend performance</h2>
						<h2 class="fragment">is to understand the page loading process</h2>
					</section>
					<section>
						<img src="img/server_talking.png">
					</section>
					<section>
						<aside class="notes">In reality</aside>
						<h2>Lot faster</h2>
						<h2 class="fragment">Lot more files</h2>
					</section>
					<section>
						<img src="img/loading_waterfall.png">
					</section>
					<section>
						<aside class="notes">If you zoom to the first line</aside>
						<img src="img/waterfall_context.png">
					</section>
					<section>
						<h2>It took almost 1 second to fetch the initial HTML</h2>
						<h2 class="fragment">It took almost 3.5 seconds to reach DOM ready</h2>
						<h2 class="fragment">It took almost 4.5 seconds to reach "loaded" event</h2>
					</section>
					<section>
						<img src="img/waterfall_parallel_requests.png">
					</section>
					<section>
						<h3>Not all images paralell</h3>
					</section>
					<section>
						<h3>Restriction</h3>
						<h2>2 connections per host</h2>
						<p>For older browsers</p>
					</section>
					<section>
						<h3>Part of the HTTP standard</h3>
					</section>
					<section>
						<h3>Modern browsers</h3>
						<h2>6 connections per host</h2>
					</section>
				</section>

				<section>
					<section>
						<h1>Load JS asynchronously</h1>
					</section>
					<section>
						<pre><code data-trim>
&lt;head&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
  &lt;script src="script.js"&gt; &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  My fancy content
&lt;/body&gt;
						</code></pre>
					</section>
					<section>
						<h2>JS loading and parsing</h2>
						<h1>blocks</h1>
						<h2>rendering process</h2>
					</section>
					<section>
						<h2>Solution 1</h2>
					</section>
					<section>
						<h2>Use <code>async</code> attribute</h2>
					</section>
					<section>
						<pre><code data-trim>
&lt;head&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
  &lt;script src="script.js" async&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  My fancy content
&lt;/body&gt;
						</code></pre>
					</section>
					<section>
						<h2><code>async</code> == not blocking</h2>
					</section>
					<section>
						<h2>Solution 2</h2>
						<p>Preferred</p>
					</section>
					<section>
						<h2>Put JS at the end of the body tag</h2>
					</section>
					<section>
						<pre><code data-trim>
&lt;head&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  My fancy content
  &lt;script src="script.js"&gt;&lt;/script&gt;
&lt;/body&gt;
						</code></pre>
					</section>
				</section>

				<section>
					<section>
						<h1>Dynamically loading of JS</h1>
					</section>
					<section>
						<h2>Defer loading of some scripts until needed</h2>
					</section>
					<section>
						<img src="img/deferred_calendar.png">
					</section>
					<section>
						<h2>Calendar is not needed until click on calendar icon</h2>
					</section>
					<section>
						<h2>Load calendar JS when clicking on the calendar</h2>
					</section>
					<section>
						<img src="img/calendar.png">
					</section>
					<section>
						<h2>Load calendar JS when hovering on the calendar</h2>
					</section>
					<section>
						<h2>Load calendar JS when all other code is loaded</h2>
					</section>
					<section>
						<h2>Result: Added</h2>
						<h1>Complexity</h1>
					</section>
					<section>
						<h2>Result: Additional</h2>
						<h1>HTTP request</h1>
					</section>
					<section>
						<h1>DON'T</h1>
						<h2>unless you create</h2>
						<h2>client side</h2>
						<h2>one page application</h2>
					</section>
					<section>
						<h1>But...</h1>
					</section>
					<section>
						<h3>save some bandwith for not used features</h3>
					</section>
					<section>
						<h2>Been there, done that</h2>
					</section>
					<section>
						<h1>Just not worth it</h1>
					</section>
					<section>
						<h3>Deferred != Bad</h3>
					</section>
					<section>
						<h2>Deferred image loading</h2>
						<h1>FTW</h1>
					</section>
					<section>
						<h1>if</h1>
					</section>
					<section>
						<h3>A lot of (big) images on the page</h3>
					</section>
					<section>
						<img src="img/podcasts.png">
					</section>
				</section>
				
				<section>
					<section>
						<h1>Browser cache</h1>
					</section>
					<section>
						<h2>When all JS is in one file</h2>
					</section>
					<section>
						<h2>Browser only has to download it once</h2>
					</section>
					<section>
						<h2>Free for the rest of the stay</h2>
					</section>
					<section>
						<ul>
							<li>Concatenate all your JS into one file</li>
							<li class="fragment">Minify it</li>
						</ul>
					</section>
					<section>
						<p>It doesn't even matter if you</p>
						<h2>Need all the JS for this page</h2>
					</section>
					<section>
						<h2>Its better to have a bigger file with first request</h2>
					</section>
					<section>
						<h2>than to have x additional requests</h2>
					</section>
					<section>
						<h2>Not always true</h2>
					</section>
					<section>
						<h2>If you have lot of JS which is only used in one part of the site...</h2>
					</section>
					<section>
						<h2>Make two files, one with basic JS for every page</h2>
					</section>
					<section>
						<h2>one with special content for a part of the page</h2>
					</section>
					<section>
						<h1>Performance</h1>
						<h2>vs</h2>
						<h1>Complexity</h1>
					</section>
				</section>
				
				<section>
					<section>
						<h1>Versioning</h1>
					</section>
					<section>
						<h2>You change your CSS</h2>
					</section>
					<section>
						<h2>Browser cached CSS</h2>
						<aside class="notes">Your new friend browser cache tricks you here</aside>
					</section>
					<section>
						<img src="img/calmclearcache.jpg">
					</section>
					<section>
						<code>&lt;script src="script.js"&gt;&lt;/script&gt;</code>
					</section>
					<section>
						<code>&lt;script src="script.js?v=12"&gt;&lt;/script&gt;</code>
					</section>
					<section>
						<aside class="notes">How we do this at srf.ch</aside>
						<pre><code data-trim>
&lt;head&gt;
  &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  My fancy content
  {render_include_statement('global')}
&lt;/body&gt;
						</code></pre>
					</section>
					<section>
						<pre><code data-trim>
[global]
javascript[]=jquery.js
javascript[]=jquery.cookie.js
...
						</code></pre>
					</section>
					<section>
						<pre><code data-trim>
function render_include(groupName) {
  files = getFilesByGroup(groupName);
  if (files.newest &gt; lastRun.timestamp) {
    result = pack(concatenate(files));
    filename = md5(files.newest);
    save_file(filename, result);
  } else {
    filename = lastRun.filename; }
  return '&lt;script src="filename"&gt;'; }
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h1>DOM manipulation</h1>
					</section>
					<section>
						<h2>DOM</h2>
						<p>=</p>
						<h2>HTML representation</h2>
						<h2>accessible by JS</h2>
						<aside class="notes">Not a technical definition</aside>
					</section>
					<section>
						<h2>We use JS to manipulate the DOM</h2>
					</section>
					<section>
						<h2>Browser has internal DOM structure</h2>
					</section>
					<section>
						<aside class="notes">What the browser has to do when executing a JS call. Not the part of jQuery, which translates the sugar syntax into othe DOM methods.</aside>
						<pre><code>$('#msg').addClass('very_important');</code></pre>
						<ul>
							<li class="fragment">Look up the <code>div</code> with id "msg" in the internal structure</li>
							<li class="fragment">Modify the internal structure</li>
							<li class="fragment">Rerender (at least parts) of the page</li>
						</ul>
					</section>
					<section>
						<h2>If manipulation is done on variable</h2>
					</section>
					<section>
						<pre><code data-trim>
var content = $('&lt;div&gt;');
content.addClass('very_important');
// more manipulation
$('#msg').append(content);
						</code></pre>
					</section>
					<section>
						<h2>This saves</h2>
						<ul>
							<li class="fragment">Modify the internal structure</li>
							<li class="fragment">Rerender (at least parts) of the page</li>
						</ul>
					</section>
					<section>
						<h2>Save DOM Lookups</h2>
						<h3>By using variables</h3>
					</section>
					<section>
						<pre><code data-trim>
$('#sidebar ul li.warn').css('color', 'red');
var text = $('#sidebar ul li.warn').text();
text = 'Wichtig: ' + text + '!!';
$('#sidebar ul li.warn').text(text);
$('#sidebar ul li.warn').css('font-size', '3em');
						</code></pre>
					</section>
					<section>
						<pre><code data-trim>
var lis = $('#sidebar ul li.important');
lis.css('color', 'red');
var text = lis.text();
text = 'Wichtig: ' + text + '!!';
lis.text(text);
lis.css('font-size', '3em');
						</code></pre>
					</section>

					<section>
						<h1>Real world example</h1>
					</section>
					<section>
						<img src="img/sendungen-a-z.png">
					</section>
					<section>
						<h2>Problem: Filtering</h2>
						<img src="img/sendungen-a-z-filter.png">
					</section>
					<section>
						<h2>Problem: Column markup in 2 &lt;ul&gt;s</h2>
						<img src="img/sendungen-a-z-two-uls.png">
					</section>
					<section>
						<h2>HTML - Selects</h2>
						<pre><code data-trim>
&lt;select id=&quot;theme&quot;&gt;
  &lt;option value=&quot;theme:news&quot;&gt;
    News
  &lt;/option&gt;
  &lt;option value=&quot;theme:twitter-relevant&quot;&gt;
    Twitter relevant
  &lt;/option&gt;
&lt;/select&gt;
						</code></pre>
					</section>
					<section>
						<h2>HTML - Letters</h2>
						<pre><code data-trim>
&lt;div class="letter" data-letter=&quot;t&quot;&gt;
  &lt;ul&gt;
    &lt;li data-attr=&quot;theme:news&quot;&gt;
      Tagesschau&lt;/li&gt;
  &lt;/ul&gt;&lt;ul&gt;
    &lt;li data-attr=&quot;theme:twitter-relevant&quot;&gt;
      Tatort&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;
						</code></pre>
										</section>
					<section>
						<h2>First aproach</h2>
						<pre><code data-trim>
var theme = $('#theme-filter').val();
var station = $('#station-filter').val();
var selector =
  '[data-attr*="' + theme + '"]'
  + '[data-attr*="' + station + '"]';

$('li').show();
$('li:not(' + selector + ')').hide();
						</code></pre>
					</section>
					<section>
						<h2>Result</h2>
						<img src="img/sendungen-a-z-first-aproach.png">
					</section>
					<section>
						<h2>Second approach</h2>
						<ul>
							<li class="fragment">Clone all <code>&lt;li&gt;</code> elements (shows) into a repository</li>
							<li class="fragment">Go through all letters, find the shows in the repository which match the letter and the filter</li>
							<li class="fragment">Append each show to the proper <code>&lt;ul&gt;</code> in the letter <code>&lt;div&gt;</code></li>
						</ul>
					</section>
					<section>
						<h2>Second approach - Cloning</h2>
						<pre><code data-trim>
$('.li-container')
  .clone()
  .appendTo($('body'))
  .addClass('copy')
  .hide();
						</code></pre>
					</section>
					<section>
						<h2>Second approach - Iterating</h2>
						<pre><code data-trim>
$('div.letter').each(function(){
  $('.li-container.copy')
    .find(selector)
    .each(function(index){
      if(index &gt; (shows.length / 2)) {
        container.find('ul.left')
          .append($(this).show());
      } else ...
     }); });
						</code></pre>
					</section>					
					<section>
						<h3>This was</h3>
						<h1>slow</h1>
					</section>
					<section>
						<h2>Third approach</h2>
					</section>
					<section>
						<h2>Third approach - Cloning</h2>
						<pre><code data-trim>
// on init
$('.li-container').appendTo('#repository');
// #repository is hidden by CSS
var shows = $('#repository').clone();
						</code></pre>						
					</section>
					<section>
						<h2>Third approach - Iterating</h2>
						<pre><code data-trim>
$('div.letter').each(function(){
  lShows = shows.find(
    selector + letterSelector);
  lShows.each(function(index){
    container.find('ul')
      .eq(index &lt; (lShows.length / 2))
      .append(this);
  });
});
						</code></pre>
					</section>					
					<section>
						<h3>This was</h3>
						<h1>fast</h1>
					</section>
					<section>
						<h3>So, what's the</h3>
						<h1>difference</h1>
					</section>
					<section>
						<h3>The key is</h3>
						<h1>DOM manipulation</h1>
					</section>
					<section>
						<h2>Second approach</h2>
						<code>clone().appendTo(whatever)</code>
					</section>
					<section>
						<h2>Third approach</h2>
						<code>var shows = repository.clone()</code>
					</section>
				</section>

				<section>
					<section>
						<h1>Recap</h1>
					</section>
					<section>
						<h2>Performance is a</h2>
						<h1>Feature</h1>
						<aside class="notes">This is the most important one, really. If you think this talk is shit but you take away this info, I'm happy :)</aside>
					</section>
					<section>
						<h2>CSS in the head</h2>
						<h2>JS just before closing tag of body</h2>
					</section>
					<section>
						<h2>Put all your CSS and JS in</h2>
						<h1>One file</h1>
						<h2>And minify it</h2>
					</section>
					<section>
						<h2>Version your CSS and JS files</h2>
					</section>
					<section>
						<h2>Save DOM manipulations</h2>
					</section>
					<section>
						<h2>Use detached variables for big manipulations</h2>
					</section>
					<section>
						<h2>Use variables to save DOM lookups</h2>
					</section>
				</section>
				
				<section>
					<h1>Q&amp;A</h1>
				</section>
				
				<section>
					<h1>Thank you!</h1>
				</section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				
				width: 1366,
			    height: 768,
			    

				theme: 'beige', // available themes are in /css/theme
				transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
